<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    归档: 2015/7
  
</title>

<meta name="description" content="CrossRun Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="CrossRun">
<meta property="og:url" content="http://crossrun.top/archives/2015/07/index.html">
<meta property="og:site_name" content="CrossRun">
<meta property="og:description" content="CrossRun Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CrossRun">
<meta name="twitter:description" content="CrossRun Blog">


  <link rel="alternative" href="/atom.xml" title="CrossRun" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">
<link rel="stylesheet" href="/styles/main.css">






</head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">CrossRun</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">CrossRun</a></h1>
    
      <p class="subtitle">
        谁与我大梦一场
      </p>
    
    <div class="info">
      <div class="content">
        
          <div class="description">CrossRun Blog</div>
        
        
          <div class="author">CrossRun</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="https://cn.gravatar.com/avatar/35fef74d731255cd569c2c2b0b9e87e4?s=200"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">分类</a>
                
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">标签</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-框架/">Android 框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Universal-Image-Loader-ImageLoader/">Android-Universal-Image-Loader,ImageLoader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android版本变迁的坑/">Android版本变迁的坑</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-java-static/">java,java-static</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/">json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/">test</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/锋芒/">锋芒</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">归档</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">14</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="http://golangtc.com/" title="Golang中国" target="_blank" rel="external">Golang中国</a>
              </li>
            
          
            
              <li>
                <a href="http://studygolang.com/" title="Golang中文社区" target="_blank" rel="external">Golang中文社区</a>
              </li>
            
          
            
              <li>
                <a href="https://coding.net/?ref=crossrun" title="Coding" target="_blank" rel="external">Coding</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/denjones/hexo-theme-chan" title="Chan" target="_blank" rel="external">Chan</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/RunCross" title="Github" target="_blank" rel="external">Github</a>
              </li>
            
          
            
              <li>
                <a href="/atom.xml" title="RSS">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    
      
      
      <section class="archives-wrap">
        <div class="archive-year-wrap">
          <h1><a href="/archives/2015" class="archive-year">2015</a></h1>
        </div>
        <div class="post-list">
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/28/Android里ListView或者ScrollView的向下事件传递小技巧/" >
  Android里ListView或者ScrollView的向下事件传递小技巧
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/28/Android里ListView或者ScrollView的向下事件传递小技巧/"><span class="article-date">
  2015-07-28
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          
        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/24/Android低版本实现Material-Design/" >
  Android低版本实现Material-Design
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/24/Android低版本实现Material-Design/"><span class="article-date">
  2015-07-24
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          
        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/16/Android-Universal-Image-Loader-图片异步加载类库的使用（超详细配置）/" >
  Android-Universal-Image-Loader-图片异步加载类库的使用（超详细配置）
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/16/Android-Universal-Image-Loader-图片异步加载类库的使用（超详细配置）/"><span class="article-date">
  2015-07-16
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-Universal-Image-Loader-ImageLoader/">Android-Universal-Image-Loader,ImageLoader</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p><a href="http://blog.csdn.net/vipzjyno1/article/details/23206387" target="_blank" rel="external">Android-Universal-Image-Loader 图片异步加载类库的使用（超详细配置）</a></p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/16/Android开源开发框架/" >
  Android开源开发框架一
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/16/Android开源开发框架/"><span class="article-date">
  2015-07-16
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-框架/">Android 框架</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>一些开发中可能会用到的框架</p>
<p>##1、volley<br>项目地址<a href="https://github.com/smanikandan14/Volley-demo" target="_blank" rel="external">https://github.com/smanikandan14/Volley-demo</a></p>
<p>(1) JSON，图像等的异步下载；<br>(2) 网络请求的排序（scheduling）<br>(3) 网络请求的优先级处理<br>(4) 缓存<br>(5) 多级别取消请求<br>(6) 和Activity和生命周期的联动（Activity结束时同时取消所有网络请求）</p>
<p>##2、android-async-http<br>项目地址：<a href="https://github.com/loopj/android-async-http" target="_blank" rel="external">https://github.com/loopj/android-async-http</a></p>
<p>文档介绍：<a href="http://loopj.com/android-async-http/" target="_blank" rel="external">http://loopj.com/android-async-http/</a></p>
<p>(1) 在匿名回调中处理请求结果<br>(2) 在UI线程外进行http请求<br>(3) 文件断点上传<br>(4) 智能重试<br>(5) 默认gzip压缩<br>(6) 支持解析成Json格式<br>(7) 可将Cookies持久化到SharedPreferences</p>
<p>##3、Afinal框架<br>项目地址：<a href="https://github.com/yangfuhai/afinal" target="_blank" rel="external">https://github.com/yangfuhai/afinal</a></p>
<p>主要有四大模块：</p>
<p>(1) 数据库模块：android中的orm框架，使用了线程池对sqlite进行操作。<br>(2) 注解模块：android中的ioc框架，完全注解方式就可以进行UI绑定和事件绑定。无需findViewById和setClickListener等。<br>(3) 网络模块：通过httpclient进行封装http数据请求，支持ajax方式加载，支持下载、上传文件功能。<br>(4) 图片缓存模块：通过FinalBitmap，imageview加载bitmap的时候无需考虑bitmap加载过程中出现的oom和android容器快速滑动时候出现的图片错位等现象。<br>FinalBitmap可以配置线程加载线程数量，缓存大小，缓存路径，加载显示动画等。FinalBitmap的内存管理使用lru算法， 没有使用弱引用（android2.3以后google已经不建议使用弱引用，android2.3后强行回收软引用和弱引用，详情查看android官方文档）， 更好的管理bitmap内存。</p>
<p>FinalBitmap可以自定义下载器，用来扩展其他协议显示网络图片，比如ftp等。同时可以自定义bitmap显示器， 在imageview显示图片的时候播放动画等（默认是渐变动画显示）。</p>
<p>##4、xUtils框架<br>项目地址：<a href="https://github.com/wyouflf/xUtils" target="_blank" rel="external">https://github.com/wyouflf/xUtils</a></p>
<p>主要有四大模块：</p>
<p>(1) 数据库模块：android中的orm框架，一行代码就可以进行增删改查；</p>
<p>支持事务，默认关闭；<br>可通过注解自定义表名，列名，外键，唯一性约束，NOT NULL约束，CHECK约束等（需要混淆的时候请注解表名和列名）；<br>支持绑定外键，保存实体时外键关联实体自动保存或更新；<br>自动加载外键关联实体，支持延时加载；<br>支持链式表达查询，更直观的查询语义，参考下面的介绍或sample中的例子.<br>(2) 注解模块：android中的ioc框架，完全注解方式就可以进行UI，资源和事件绑定；</p>
<p>新的事件绑定方式，使用混淆工具混淆后仍可正常工作；<br>目前支持常用的20种事件绑定，参见ViewCommonEventListener类和包com.lidroid.xutils.view.annotation.event。<br>(3) 网络模块：支持同步，异步方式的请求；</p>
<p>支持大文件上传，上传大文件不会oom；<br>支持GET，POST，PUT，MOVE，COPY，DELETE，HEAD，OPTIONS，TRACE，CONNECT请求；<br>下载支持301/302重定向，支持设置是否根据Content-Disposition重命名下载的文件；<br>返回文本内容的请求(默认只启用了GET请求)支持缓存，可设置默认过期时间和针对当前请求的过期时间。</p>
<p>(4) 图片缓存模块：加载bitmap的时候无需考虑bitmap加载过程中出现的oom和android容器快速滑动时候出现的图片错位等现象；</p>
<p>支持加载网络图片和本地图片；<br>内存管理使用lru算法，更好的管理bitmap内存；<br>可配置线程加载线程数量，缓存大小，缓存路径，加载显示动画等…</p>
<p>##5、ThinkAndroid<br>项目地址：<a href="https://github.com/white-cat/ThinkAndroid" target="_blank" rel="external">https://github.com/white-cat/ThinkAndroid</a></p>
<p>主要有以下模块：</p>
<p>(1) MVC模块：实现视图与模型的分离。<br>(2) ioc模块：android中的ioc模块，完全注解方式就可以进行UI绑定、res中的资源的读取、以及对象的初始化。<br>(3) 数据库模块：android中的orm框架，使用了线程池对sqlite进行操作。<br>(4) http模块：通过httpclient进行封装http数据请求，支持异步及同步方式加载。<br>(5) 缓存模块：通过简单的配置及设计可以很好的实现缓存，对缓存可以随意的配置<br>(6) 图片缓存模块：imageview加载图片的时候无需考虑图片加载过程中出现的oom和android容器快速滑动时候出现的图片错位等现象。<br>(7) 配置器模块：可以对简易的实现配对配置的操作，目前配置文件可以支持Preference、Properties对配置进行存取。<br>(8) 日志打印模块：可以较快的轻易的是实现日志打印，支持日志打印的扩展，目前支持对sdcard写入本地打印、以及控制台打印<br>(9) 下载器模块:可以简单的实现多线程下载、后台下载、断点续传、对下载进行控制、如开始、暂停、删除等等。<br>(10) 网络状态检测模块：当网络状态改变时，对其进行检</p>
<p>##6、LoonAndroid<br>项目地址：<a href="https://github.com/gdpancheng/LoonAndroid" target="_blank" rel="external">https://github.com/gdpancheng/LoonAndroid</a></p>
<p>主要有以下模块：</p>
<p>(1) 自动注入框架（只需要继承框架内的application既可）<br>(2) 图片加载框架（多重缓存，自动回收，最大限度保证内存的安全性）<br>(3) 网络请求模块（继承了基本上现在所有的http请求）<br>(4) eventbus（集成一个开源的框架）<br>(5) 验证框架（集成开源框架）<br>(6) json解析（支持解析成集合或者对象）<br>(7) 数据库（不知道是哪位写的 忘记了）<br>(8) 多线程断点下载（自动判断是否支持多线程，判断是否是重定向）<br>(9) 自动更新模块<br>(10) 一系列工具类<br>其中的 volley扩展性非常好，个人比较喜欢的风格。其他如 android-async-http、Afinal 也相当不错。</p>
<p>##7、AndroidAnnotations<br>项目地址：</p>
<p>AndroidAnnotations首页</p>
<p>github上的项目地址</p>
<p>主要有以下特点：</p>
<p>使用依赖注入(DI)、控制反转(IOC)来简化开发过程<br>简化的线程模型（Simplified threading model)<br>事件绑定（Event binding）<br>REST Client<br>No Magic<br>类似框架：Bufferknife</p>
<p>##8、RoboGuice<br>项目地址：<a href="https://github.com/roboguice/roboguice" target="_blank" rel="external">https://github.com/roboguice/roboguice</a></p>
<p>RoboGuice 使得进行Android开发更加方便，使得开发变得更加简单也更有乐趣。当你调用getIntent().getExtras()是不是经常检查是否为null？RoboGuice可以帮助你。想想调用findViewById()并映射到TextView确实有必要么？RoboGuice也可以帮你。</p>
<p>RoboGuice 可以帮助解决这类的判断工作。你再也不用记住，是通过调用bindService获取一个用户service，调用getSystemService获取一个系统service。注入你的view、service、或者其他对象，然后让RoboGuice来处理剩下的事宜。</p>
<p>RoboGuice 精简了你的应用代码。更少的代码意味着bug也会更少。也使得阅读代码更加容易，不在纠缠于Android平台的各种特性，而是关注于应用实际的业务逻辑。</p>
<p>没什么很难的，你所需要做的仅仅是配置RoboGuice。</p>
<p>##9、Dagger<br>项目地址<a href="https://github.com/square/dagger" target="_blank" rel="external">https://github.com/square/dagger</a></p>
<p>android的依赖注入框架（DI框架），感觉跟Spring 的IOC差不多吧。这个框架它的好处是它没有采用反射技术（Spring是用反射的）,而是用预编译技术，因为基于反射的DI非常地耗用资源（空间，时间）</p>
<p>##10、Fresco　<br>中文文档<a href="http://fresco-cn.org/" target="_blank" rel="external">http://fresco-cn.org/</a> 项目地址<a href="https://github.com/facebook/fresco" target="_blank" rel="external">https://github.com/facebook/fresco</a></p>
<p>Fresco 是一个强大的图片加载组件。</p>
<p>Fresco 中设计有一个叫做 image pipeline 的模块。它负责从网络，从本地文件系统，本地资源加载图片。为了最大限度节省空间和CPU时间，它含有3级缓存设计（2级内存，1级文件）。</p>
<p>Fresco 中设计有一个叫做 Drawees 模块，方便地显示loading图，当图片不再显示在屏幕上时，及时地释放内存和空间占用。</p>
<p>特性：</p>
<p>内存管理<br>图片的渐进式呈现<br>支持加载Gif图，支持WebP格式</p>
<p>##11、ActiveAndroid<br>项目地址：<a href="https://github.com/pardom/ActiveAndroid" target="_blank" rel="external">https://github.com/pardom/ActiveAndroid</a></p>
<p>ActiveAndroid是一个活跃的记录风格的ORM（对象关系映射）库。ActiveAndroid可以让您保存和检索的SQLite数据库记录而没有写一个SQL语句。每个数据库记录被整齐包裹成一个model类,像保存方法（）和delete（）。</p>
<p>##12、Android-Universal-Image-Loader<br>项目地址：<a href="https://github.com/nostra13/Android-Universal-Image-Loader" target="_blank" rel="external">https://github.com/nostra13/Android-Universal-Image-Loader</a></p>
<p>Android-Universal-Image-Loader是一个开源的UI组件程序，该项目的目的是提供一个可重复使用的仪器为异步图像加载，缓存和显示。所以，如果你的程序里需要这个功能的话，那么不妨试试它。因为已经封装好了一些类和方法。我们 可以直接拿来用了。而不用重复去写了。其实，写一个这方面的程序还是比较麻烦的，要考虑多线程，缓存，内存溢出等很多方面。但是，你也可以参考这个例子来自己写出更好的程序。</p>
<p>本文转载自：<a href="http://coolshell.info/blog/2014/10/android-opensource.html" target="_blank" rel="external">值得推荐的android开源框架</a></p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/09/java-static-赋值null/" >
  java static 赋值null
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/09/java-static-赋值null/"><span class="article-date">
  2015-07-09
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-java-static/">java,java-static</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>Java基本功不扎实，遇到一个没遇见过的问题，记录下来备忘。</p>
<p>##现象<br>今天遇到一个少见的问题，单例模式中，在外部通过<code>getInstance()</code> 方法获取实例之后，置为null，并不会影响内部的<code>static</code>变量。<br>这是主程序:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		StaticClass test = StaticClass.getInstance();</span><br><span class="line">		System.out.println(<span class="string">"new: "</span>+test);</span><br><span class="line">		test = <span class="keyword">null</span>;</span><br><span class="line">		System.out.println(<span class="string">"null: "</span>+test);</span><br><span class="line">		StaticClass.log();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是<code>StaticClass</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class StaticClass &#123;</span><br><span class="line">	private static StaticClass instance = null;</span><br><span class="line"></span><br><span class="line">	private StaticClass() &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static StaticClass getInstance() &#123;</span><br><span class="line">		if (instance == null) &#123;</span><br><span class="line">			instance = new StaticClass();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(&quot;getInstance: &quot; + instance);</span><br><span class="line">		return instance;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void log()&#123;</span><br><span class="line">		System.out.println(&quot;is null: &quot;+(instance==null));</span><br><span class="line">		System.out.println(instance);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getInstance: StaticClass@659e0bfd</span><br><span class="line">new: StaticClass@659e0bfd</span><br><span class="line">null: null</span><br><span class="line">is null: false</span><br><span class="line">StaticClass@659e0bfd</span><br></pre></td></tr></table></figure></p>
<p>可以看到，在 <code>main()</code> 方法中，<code>test = null</code> 并不能把 <code>StaticClass</code> 里的  <code>instance</code> 变成 <code>null</code> ，<code>instance</code> 仍然占有内存，并有自己的实例。<br>只有在<code>StaticClass</code>内部显式的执行<code>instance = null</code> 才能得到想要的结果。</p>
<p>##猜测原因<br>目前猜测是由于 <code>static</code> 属性导致的，具体的解释还需要查找更多的解释。</p>
<p>##后记<br>自己的Java基础真是弱爆了，还是不能很好的理解 <code>引用</code> 这个概念。习惯C的指针那种理解。Java里，A类通过方法return一个obj，在外部<code>obj=null</code>是不会影响到A类内部持有的obj。想要释放某个资源，一般都是 <code>close()</code> 或者 <code>release()</code> 之类的，交由 A类内部去释放置空。本文的起因和是不是 <code>static</code> 没关系。</p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/08/JSON-RPC-2-0-规范-中文版-转载/" >
  JSON-RPC 2.0 规范(中文版)(转载)
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/08/JSON-RPC-2-0-规范-中文版-转载/"><span class="article-date">
  2015-07-08
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json/">json</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p><font size="2">本文转载自：<a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="external">原文链接</a><font><br>   <div id="container"></div></font></font></p>
<div id="header"><br>  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Specification">Specification</a>&nbsp;»&nbsp;(译) JSON-RPC 2.0 规范(中文版)</div><br></div><br><div class="clearfix"></div><br><div id="title">(译) JSON-RPC 2.0 规范(中文版)</div><br>  <div id="content"><br>  <ul><br><li><br><p>起源时间: 2010-03-26(基于2009-05-24版本)</p><br></li><br><li><br><p>更新: 2013-01-04</p><br></li><br><li><br><p>作者: <a href="https://groups.google.com/forum/#!forum/json-rpc" target="_blank" rel="external">JSON-RPC工作组</a>&lt; json-rpc@googlegroups.com &gt;</p><br></li><br><li>原文链接: <a href="http://www.jsonrpc.org/specification" target="_blank" rel="external">http://www.jsonrpc.org/specification</a></li><br><li>翻译:  <a href="http://geekdream.com" target="_blank" rel="external">leozvc</a> &lt; xxfs91@gmail.com &gt;</li><br></ul><br><div class="toc"><span class="toctitle">Table of Contents</span><ul><br><li><a href="#1">1.概述</a></li><br><li><a href="#2">2.约定</a></li><br><li><a href="#3">3.兼容性</a></li><br><li><a href="#4">4.请求对象</a><ul><br><li><a href="#41">4.1通知</a></li><br><li><a href="#42">4.2参数结构</a></li><br></ul><br></li><br><li><a href="#5">5.响应对象</a><ul><br><li><a href="#51">5.1错误对象</a></li><br></ul><br></li><br><li><a href="#6">6.批量调用</a></li><br><li><a href="#7">7.示例</a></li><br><li><a href="#7_1">7.扩展</a></li><br></ul><br></div><br><h2 id="1">1.概述</h2><br><p>JSON-RPC是一个无状态且轻量级的远程过程调用(RPC)协议。 本规范主要定义了一些数据结构及其相关的处理规则。它允许运行在基于socket,http等诸多不同消息传输环境的同一进程中。其使用<a href="http://www.json.org/" target="_blank" rel="external">JSON</a>（<a href="http://www.ietf.org/rfc/rfc4627.txt" target="_blank" rel="external">RFC 4627</a>）作为数据格式。  </p><br><p>它为简单而生!</p><br><h2 id="2">2.约定</h2><br><p>文档中关键字”MUST”、”MUST NOT”、”REQUIRED”、”SHALL”、”SHALL NOT”、”SHOULD”、”SHOULD NOT”、”RECOMMENDED”、”MAY”和 “OPTIONAL” 将在<a href="http://www.ietf.org/rfc/rfc2119.txt" target="_blank" rel="external">RFC 2119</a> 中得到详细的解释及描述。</p><br><p>由于JSON-RPC使用JSON，它具有与其相同的类型系统(见<a href="http://www.json.org" target="_blank" rel="external">http://www.json.org</a>或<a href="http://www.ietf.org/rfc/rfc4627.txt" target="_blank" rel="external">RFC 4627</a>)。JSON可以表示四个基本类型(String、Numbers、Booleans和Null)和两个结构化类型(Objects和Arrays)。 规范中，术语“Primitive”标记那4种原始类型，“Structured”标记两种结构化类型。任何时候文档涉及JSON数据类型，第一个字母都必须大写：Object，Array，String，Number，Boolean，Null。包括True和False也要大写。</p><br><p>在客户端与任何被匹配到的服务端之间交换的所有成员名字应是区分大小写的。 函数、方法、过程都可以认为是可以互换的。</p><br><p>客户端被定义为请求对象的来源及响应对象的处理程序。</p><br><p>服务端被定义为响应对象的起源和请求对象的处理程序。</p><br><p>该规范的一种实现为可以轻而易举的填补这两个角色,即使是在同一时间,同一客户端或其他不相同的客户端。 该规范不涉及复杂层。</p><br><h2 id="3">3.兼容性</h2><br><p>JSON-RPC 2.0 的请求对象和响应对象可能无法在现用的JSON-RPC 1.0 客户端或服务端工作，然而我们可以很容易在两个版本间区分出2.0，总会包含一个成员命名为 “jsonrpc” 且值为“2.0”， 而1.0版本是不包含的。大部分的2.0实现应该考虑尝试处理1.0的对象，即使不是对等的也应给其相关提示。</p><br><h2 id="4">4.请求对象</h2><br><p>发送一个请求对象至服务端代表一个rpc调用， 一个请求对象包含下列成员：</p><br><p><strong>jsonrpc</strong></p><br><blockquote><br><p>指定JSON-RPC协议版本的字符串，必须准确写为“2.0”</p><br></blockquote><br><p><strong>method</strong></p><br><blockquote><br><p>包含所要调用方法名称的字符串，以rpc开头的方法名，用英文句号（U+002E or ASCII 46）连接的为预留给rpc内部的方法名及扩展名，且不能在其他地方使用。</p><br></blockquote><br><p><strong>params</strong></p><br><blockquote><br><p>调用方法所需要的结构化参数值，该成员参数可以被省略。</p><br></blockquote><br><p><strong>id</strong></p><br><blockquote><br><p>已建立客户端的唯一标识id，值必须包含一个字符串、数值或NULL空值。如果不包含该成员则被认定为是一个通知。该值一般不为NULL<a href="#id1">[1]</a>，若为数值则不应该包含小数<a href="#id2">[2]</a>。</p><br></blockquote><br><p>服务端必须回答相同的值如果包含在响应对象。 这个成员用来两个对象之间的关联上下文。</p><br><p><a name="id1">[1]</a><br>在请求对象中不建议使用NULL作为id值，因为该规范将使用空值认定为未知id的请求。另外，由于JSON-RPC 1.0 的通知使用了空值，这可能引起处理上的混淆。</p><br><p><a name="id2">[2]</a><br>使用小数是不确定性的，因为许多十进制小数不能精准的表达为二进制小数。</p><br><h3 id="41">4.1通知</h3><br><p>没有包含“id”成员的请求对象为通知，<br>作为通知的请求对象表明客户端对相应的响应对象并不感兴趣，本身也没有响应对象需要返回给客户端。服务端必须不回复一个通知，包含那些批量请求中的。</p><br><p>由于通知没有返回的响应对象，所以通知不确定是否被定义。同样，客户端不会意识到任何错误（例如参数缺省，内部错误）。</p><br><h3 id="42">4.2参数结构</h3><br><p>rpc调用如果存在参数则必须为基本类型或结构化类型的参数值，要么为索引数组，要么为关联数组对象。</p><br><ul><br><li><br><p>索引：参数必须为数组，并包含与服务端预期顺序一致的参数值。</p><br></li><br><li><br><p>关联名称：参数必须为对象，并包含与服务端相匹配的参数成员名称。没有在预期中的成员名称可能会引起错误。名称必须完全匹配，包括方法的预期参数名以及大小写。</p><br></li><br></ul><br><h2 id="5">5.响应对象</h2><br><p>当发起一个rpc调用时，除通知之外，服务端都必须回复响应。响应表示为一个JSON对象，使用以下成员：</p><br><p><strong>jsonrpc</strong></p><br><blockquote><br><p>指定JSON-RPC协议版本的字符串，必须准确写为“2.0”</p><br></blockquote><br><p><strong>result</strong></p><br><blockquote><br><p>该成员在成功时必须包含。</p><br><p>当调用方法引起错误时必须不包含该成员。</p><br><p>服务端中的被调用方法决定了该成员的值。</p><br></blockquote><br><p><strong>error</strong></p><br><blockquote><br><p>该成员在失败是必须包含。</p><br><p>当没有引起错误的时必须不包含该成员。</p><br><p>该成员参数值必须为5.1中定义的对象。</p><br></blockquote><br><p><strong>id</strong></p><br><blockquote><br><p>该成员必须包含。</p><br><p>该成员值必须于请求对象中的id成员值一致。</p><br><p>若在检查请求对象id时错误（例如参数错误或无效请求），则该值必须为空值。</p><br></blockquote><br><p>响应对象必须包含result或error成员，但两个成员必须不能同时包含。</p><br><h3 id="51">5.1错误对象</h3><br><p>当一个rpc调用遇到错误时，返回的响应对象必须包含错误成员参数，并且为带有下列成员参数的对象：</p><br><p><strong>code</strong></p><br><blockquote><br><p>使用数值表示该异常的错误类型。<br>必须为整数。</p><br></blockquote><br><p><strong>message</strong></p><br><blockquote><br><p>对该错误的简单描述字符串。<br>该描述应尽量限定在简短的一句话。</p><br></blockquote><br><p><strong>data</strong></p><br><blockquote><br><p>包含关于错误附加信息的基本类型或结构化类型。该成员可忽略。<br>该成员值由服务端定义（例如详细的错误信息，嵌套的错误等）。</p><br></blockquote><br><p>-32768至-32000为保留的预定义错误代码。在该范围内的错误代码不能被明确定义，保留下列以供将来使用。错误代码基本与XML-RPC建议的一样，url：<br><a href="http://xmlrpc-epi.sourceforge.net/specs/rfc.fault_codes.php" target="_blank" rel="external">http://xmlrpc-epi.sourceforge.net/specs/rfc.fault_codes.php</a></p><br><table><br><thead><br><tr><br><th>code</th><br><th>message</th><br><th>meaning</th><br></tr><br></thead><br><tbody><br><tr><br><td>-32700</td><br><td>Parse error语法解析错误</td><br><td>服务端接收到无效的json。该错误发送于服务器尝试解析json文本</td><br></tr><br><tr><br><td>-32600</td><br><td>Invalid Request无效请求</td><br><td>发送的json不是一个有效的请求对象。</td><br></tr><br><tr><br><td>-32601</td><br><td>Method not found找不到方法</td><br><td>该方法不存在或无效</td><br></tr><br><tr><br><td>-32602</td><br><td>Invalid params无效的参数</td><br><td>无效的方法参数。</td><br></tr><br><tr><br><td>-32603</td><br><td>Internal error内部错误</td><br><td>JSON-RPC内部错误。</td><br></tr><br><tr><br><td>-32000 to -32099</td><br><td>Server error服务端错误</td><br><td>预留用于自定义的服务器错误。</td><br></tr><br></tbody><br></table><br><p>除此之外剩余的错误类型代码可供应用程序作为自定义错误。</p><br><h2 id="6">6.批量调用</h2><br><p>当需要同时发送多个请求对象时，客户端可以发送一个包含所有请求对象的数组。</p><br><p>当批量调用的所有请求对象处理完成时，服务端则需要返回一个包含相对应的响应对象数组。每个响应对象都应对应每个请求对象，除非是通知的请求对象。服务端可以并发的，以任意顺序和任意宽度的并行性来处理这些批量调用。</p><br><p>这些相应的响应对象可以任意顺序的包含在返回的数组中，而客户端应该是基于各个响应对象中的id成员来匹配对应的请求对象。</p><br><p>若批量调用的rpc操作本身非一个有效json或一个至少包含一个值的数组，则服务端返回的将单单是一个响应对象而非数组。若批量调用没有需要返回的响应对象，则服务端不需要返回任何结果且必须不能返回一个空数组给客户端。</p><br><h2 id="7">7.示例</h2><br><p>Syntax:</p><br><div class="hlcode"><pre><span class="o">–&gt;</span> data sent to Server<br><span class="o">&lt;–</span> data sent to Client<br></pre></div>


<p></p><p>带索引数组参数的rpc调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;subtract&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">42</span><span class="p">,</span> <span class="m">23</span><span class="p">],</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">}</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="m">19</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">}</span><br><br><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;subtract&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">23</span><span class="p">,</span> <span class="m">42</span><span class="p">],</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">2</span><span class="p">}</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="m">-19</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">2</span><span class="p">}</span><br></pre></div>


<p></p><p>带关联数组参数的rpc调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;subtract&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;subtrahend&quot;</span><span class="o">:</span> <span class="m">23</span><span class="p">,</span> <span class="s">&quot;minuend&quot;</span><span class="o">:</span> <span class="m">42</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">3</span><span class="p">}</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="m">19</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">3</span><span class="p">}</span><br><br><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;subtract&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;minuend&quot;</span><span class="o">:</span> <span class="m">42</span><span class="p">,</span> <span class="s">&quot;subtrahend&quot;</span><span class="o">:</span> <span class="m">23</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">4</span><span class="p">}</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="m">19</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="m">4</span><span class="p">}</span><br></pre></div>


<p></p><p>通知:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;update&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]}</span><br><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;foobar&quot;</span><span class="p">}</span><br></pre></div>


<p></p><p>不包含调用方法的rpc调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;foobar&quot;</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span><span class="p">}</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32601</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Method not found&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span><span class="p">}</span><br></pre></div>


<p></p><p>包含无效json的rpc调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;foobar, &quot;</span>params<span class="s">&quot;: &quot;</span>bar<span class="s">&quot;, &quot;</span>baz<span class="p">]</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32700</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Parse error&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">}</span><br></pre></div>


<p></p><p>包含无效请求对象的rpc调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="s">&quot;bar&quot;</span><span class="p">}</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">}</span><br></pre></div>


<p></p><p>包含无效json的rpc批量调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">[</span><br>        <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;sum&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">],</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span><span class="p">},</span><br>        <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><br>    <span class="p">]</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32700</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Parse error&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">}</span><br></pre></div>


<p></p><p>包含空数组的rpc调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">[]</span><br><span class="o">&lt;–</span> <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">}</span><br></pre></div>


<p></p><p>非空且无效的rpc批量调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">[</span><span class="m">1</span><span class="p">]</span><br><span class="o">&lt;–</span> <span class="p">[</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">}</span><br>    <span class="p">]</span><br></pre></div>


<p></p><p>无效的rpc批量调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><br><span class="o">&lt;–</span> <span class="p">[</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">}</span><br>    <span class="p">]</span><br></pre></div>


<p></p><p>rpc批量调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">[</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;sum&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">],</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;notify_hello&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">7</span><span class="p">]},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;subtract&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">42</span><span class="p">,</span><span class="m">23</span><span class="p">],</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;2&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;foo&quot;</span><span class="o">:</span> <span class="s">&quot;boo&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;foo.get&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;myself&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;5&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;get_data&quot;</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;9&quot;</span><span class="p">}</span><br>    <span class="p">]</span><br><span class="o">&lt;–</span> <span class="p">[</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="m">7</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="m">19</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;2&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32600</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Invalid Request&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> null<span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s">&quot;code&quot;</span><span class="o">:</span> <span class="m">-32601</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="o">:</span> <span class="s">&quot;Method not found&quot;</span><span class="p">},</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;5&quot;</span><span class="p">},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;result&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="m">5</span><span class="p">],</span> <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;9&quot;</span><span class="p">}</span><br>    <span class="p">]</span><br></pre></div>


<p></p><p>所有都为通知的rpc批量调用:</p><p></p>
<div class="hlcode"><pre><span class="o">–&gt;</span> <span class="p">[</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;notify_sum&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">]},</span><br>    <span class="p">{</span><span class="s">&quot;jsonrpc&quot;</span><span class="o">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="o">:</span> <span class="s">&quot;notify_hello&quot;</span><span class="p">,</span> <span class="s">&quot;params&quot;</span><span class="o">:</span> <span class="p">[</span><span class="m">7</span><span class="p">]}</span><br><span class="p">]</span><br><br><span class="o">&lt;–</span> <span class="o">//</span>Nothing is returned <span class="kr">for</span> all notification batches<br></pre></div>


<p></p><h2 id="7_1">7.扩展</h2><p></p>
<p></p><p>以rpc开头的方法名预留作为系统扩展，且必须不能用于其他地方。每个系统扩展都应该有相关规范文档，所有系统扩展都应是可选的。</p><p></p>
<p><hr></p>
<p></p><p>Copyright (C) 2007-2010 by the JSON-RPC Working Group</p><p></p>
<p></p><p>This document and translations of it may be used to implement JSON-RPC, it may be copied and furnished to others, and derivative works that comment on or otherwise explain it or assist in its implementation may be prepared, copied, published and distributed, in whole or in part, without restriction of any kind, provided that the above copyright notice and this paragraph are included on all such copies and derivative works. However, this document itself may not bemodified in any way.</p><br></div><p></p>
<pre><code>    &lt;/div&gt;
    &lt;div id=&quot;footer&quot;&gt;
        &lt;span&gt;
            Copyright © 2012-2014 leozvc.
            Powered by &lt;a href=&quot;http://simiki.org/&quot; target=&quot;_blank&quot;&gt;Simiki&lt;/a&gt;.
        &lt;/span&gt;
    &lt;/div&gt;
    &lt;div style=&quot;display:none&quot;&gt;

&lt;script type=&quot;text/javascript&quot;&gt;var cnzz_protocol = ((&quot;https:&quot; == document.location.protocol) ? &quot; https://&quot; : &quot; http://&quot;);document.write(unescape(&quot;%3Cspan id=&apos;cnzz_stat_icon_4152214&apos;%3E%3C/span%3E%3Cscript src=&apos;&quot; + cnzz_protocol + &quot;s4.cnzz.com/stat.php%3Fid%3D4152214%26show%3Dpic&apos; type=&apos;text/javascript&apos;%3E%3C/script%3E&quot;));&lt;/script&gt;
</code></pre><p></p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/06/Android实现可滑动循环滚动的Banner/" >
  Android实现可滑动循环滚动的Banner
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/06/Android实现可滑动循环滚动的Banner/"><span class="article-date">
  2015-07-06
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>应用中经常有类似网页中那种的banner头，可以循环展示图片，用户也可以手动拖动。本文提供一种利用ImageSwitcher实现的方法。</p>
<p>##显示位置<br>首先，是要显示banner位置的布局</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:background</span>=<span class="string">"#ffffff"</span></span><br><span class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"180dp"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span><br><span class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/viewpager2"</span></span><br><span class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:background</span>=<span class="string">"#ffffff"</span></span><br><span class="line">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageSwitcher</span></span><br><span class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/img_switcher"</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ImageSwitcher</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span><br><span class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/tip_layout"</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span><br><span class="line">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span><br><span class="line">        <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></span><br><span class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"7dp"</span></span><br><span class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"30dp"</span></span><br><span class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span><br><span class="line">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>R.id.viewpager2</code> 是 承载整个banner的布局 ；<br><code>R.id.tip_layout</code> 是指示器，就是下方的小圆点，用来显示当前第几张图片<br><code>R.id.img_switcher</code> 是图片的位置</p>
<p>##用法<br>在布局的<code>Activity</code>里的<code>onCreate()</code> 里添加如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> BannerViewManager mAdvManager;</span><br><span class="line">   <span class="keyword">private</span> RelativeLayout mViewPagerLay;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">     ...</span><br><span class="line">     mViewPagerLay = (RelativeLayout) findViewById(R.id.viewpager2);</span><br><span class="line">     mAdvManager = <span class="keyword">new</span> BannerViewManager(<span class="keyword">this</span>, mViewPagerLay, uriList,<span class="keyword">null</span>);</span><br><span class="line">     ...</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mAdvManager != <span class="keyword">null</span>)</span><br><span class="line">		mAdvManager.onPause();</span><br><span class="line">	<span class="keyword">super</span>.onPause();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">	<span class="keyword">super</span>.onDestroy();</span><br><span class="line">	<span class="keyword">if</span> (mAdvManager != <span class="keyword">null</span>)</span><br><span class="line">		mAdvManager.onDestroy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onResume();</span><br><span class="line">	<span class="keyword">if</span> (mAdvManager != <span class="keyword">null</span>)</span><br><span class="line">		mAdvManager.onResume();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>onResume() onPause() onDestroy()</code>  三个是为了更好的节省资源设计的，因为自动滚动肯定需要一个计时器来，那么，当界面不显示的时候，就销毁计时器来达到节省资源的目的。</p>
<p>##BannerViewManager解析<br>整个<code>BannerViewManager</code> 是由两部分组成，一个是<code>ImageSwitcher</code> 用来展示图片，另一个是 <code>Timer</code> 用来自动循环。并通过<code>ImageSwitcher</code>的<code>setOnTouchListener()</code> 来实现响应用户左右滑动的手势，在最后一张图片向右滑动会显示第一张图片，同理，第一张也是。<br><code>onBannerClick()</code> 响应用户单击某张图片的单击事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cmcc.hy.hospital.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Timer;</span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Message;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnTouchListener;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup.LayoutParams;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.AnimationUtils;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageSwitcher;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"><span class="keyword">import</span> android.widget.ScrollView;</span><br><span class="line"><span class="keyword">import</span> android.widget.ViewSwitcher.ViewFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cmcc.hy.hospital.activity.R;</span><br><span class="line"><span class="keyword">import</span> com.cmcc.hy.hospital.util.ImageCacheUtil;</span><br><span class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.ImageLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BannerViewManager</span> <span class="keyword">extends</span> <span class="title">Handler</span> <span class="keyword">implements</span> <span class="title">ViewFactory</span>,</span><br><span class="line">		<span class="title">OnTouchListener</span>, <span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">enum</span> BannerAction &#123;</span><br><span class="line">		login, bind, gaokao, kouyu;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">enum</span> BannerType &#123;</span><br><span class="line">		local, net;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_NEXT = <span class="number">1001</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_BANNERS = <span class="number">1002</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String key_uri = <span class="string">"uri"</span>;</span><br><span class="line">	<span class="keyword">private</span> View mRoot;</span><br><span class="line">	<span class="keyword">private</span> ScrollView mSv;</span><br><span class="line">	<span class="keyword">private</span> Context mContext;</span><br><span class="line">	<span class="keyword">private</span> ImageSwitcher mImageSwitcher;</span><br><span class="line">	<span class="keyword">private</span> LinearLayout mTipsRoot;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] mTipsId = &#123; R.drawable.dian1,</span><br><span class="line">			R.drawable.dian2 &#125;;</span><br><span class="line">	<span class="keyword">private</span> ImageView[] mTipsView;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> currentPosition = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mCurrTipsIndex = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// 最后一次切换时间</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> mLastTime;</span><br><span class="line">	<span class="comment">// 自动切换间隔</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mInterval = <span class="number">2500</span>;</span><br><span class="line">	<span class="comment">// 自动切换线程是否继续</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> mIsRun = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; mBannerList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">	<span class="keyword">private</span> TimerTask mTask;</span><br><span class="line">	<span class="keyword">private</span> Timer mTimer;</span><br><span class="line"><span class="comment">//	private DisplayImageOptions failedOptions;</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BannerViewManager</span><span class="params">(Context context, View root, ScrollView sv)</span> </span>&#123;</span><br><span class="line">		mContext = context;</span><br><span class="line">		mRoot = root;</span><br><span class="line">		mSv = sv;</span><br><span class="line">		getBannerInfo();</span><br><span class="line">		BannerViewManager.<span class="keyword">this</span>.sendEmptyMessage(SHOW_BANNERS);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		initSwitcher();</span><br><span class="line">		initTips();</span><br><span class="line">		startAutoSwitch();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		stopAutoSwitch();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		startAutoSwitch();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		stopAutoSwitch();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> View <span class="title">makeView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		ImageView img = <span class="keyword">new</span> ImageView(mContext);</span><br><span class="line">		img.setScaleType(ImageView.ScaleType.FIT_XY);</span><br><span class="line">		img.setLayoutParams(<span class="keyword">new</span> ImageSwitcher.LayoutParams(</span><br><span class="line">				LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT));</span><br><span class="line">		<span class="keyword">return</span> img;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initSwitcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mImageSwitcher = (ImageSwitcher) mRoot.findViewById(R.id.img_switcher);</span><br><span class="line">		mImageSwitcher.setFactory(<span class="keyword">this</span>);</span><br><span class="line">		displayImage(mBannerList.get(<span class="number">0</span>));</span><br><span class="line">		<span class="keyword">if</span> (mBannerList.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">			mImageSwitcher.setOnTouchListener(<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// mImageSwitcher.setOnClickListener(this);</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ImageView imageView;</span><br><span class="line">	<span class="comment">// 调用imageloader显示图片</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">displayImage</span><span class="params">(String uri)</span> </span>&#123;</span><br><span class="line">		imageView=(ImageView) mImageSwitcher.getNextView();</span><br><span class="line"><span class="comment">//		imageView.setScaleType(ImageView.ScaleType.FIT_XY);</span></span><br><span class="line"><span class="comment">//		if(uri.startsWith("drawable:"))&#123;</span></span><br><span class="line"><span class="comment">//		imageView.setImageResource(Integer.valueOf(uri.split("//")[1]));&#125;</span></span><br><span class="line"><span class="comment">//		else&#123;</span></span><br><span class="line">		ImageLoader.getInstance().displayImage(uri,</span><br><span class="line">				imageView,ImageCacheUtil.OPTIONS.default_options);</span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//		ImageLoader.getInstance().displayImage(uri,imageView,ImageCacheUtil.OPTIONS.default_options);</span></span><br><span class="line">		mImageSwitcher.showNext();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化view指示器</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initTips</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> size = mBannerList.size();</span><br><span class="line">		<span class="keyword">if</span> (size &lt;= <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		mTipsRoot = (LinearLayout) mRoot.findViewById(R.id.tip_layout);</span><br><span class="line">		mTipsView = <span class="keyword">new</span> ImageView[size];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = size; i &lt; length; i++) &#123;</span><br><span class="line">			ImageView mImageView = <span class="keyword">new</span> ImageView(mContext);</span><br><span class="line">			LinearLayout.LayoutParams layoutParams = <span class="keyword">new</span> LinearLayout.LayoutParams(</span><br><span class="line">					<span class="keyword">new</span> ViewGroup.LayoutParams(LayoutParams.WRAP_CONTENT,</span><br><span class="line">							LayoutParams.WRAP_CONTENT));</span><br><span class="line">			layoutParams.leftMargin = <span class="number">7</span>;</span><br><span class="line">			mImageView.setBackgroundResource(mTipsId[<span class="number">1</span>]);</span><br><span class="line">			mTipsRoot.addView(mImageView, layoutParams);</span><br><span class="line">			mTipsView[i] = mImageView;</span><br><span class="line">		&#125;</span><br><span class="line">		setCurrTips(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getBannerInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 指示器变化</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setCurrTips</span><span class="params">(<span class="keyword">int</span> selectItems)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (mTipsView == <span class="keyword">null</span> || mTipsView.length == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		mTipsView[mCurrTipsIndex].setBackgroundResource(mTipsId[<span class="number">1</span>]);</span><br><span class="line">		mTipsView[selectItems].setBackgroundResource(mTipsId[<span class="number">0</span>]);</span><br><span class="line">		mCurrTipsIndex = selectItems;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 轮播展示</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAutoSwitch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> size = mBannerList.size();</span><br><span class="line">		<span class="keyword">if</span> (size &lt;= <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		stopAutoSwitch();</span><br><span class="line">		mLastTime = System.currentTimeMillis();</span><br><span class="line">		mIsRun = <span class="keyword">true</span>;</span><br><span class="line">		mTask = <span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">if</span> (mIsRun</span><br><span class="line">						&amp;&amp; (Math.abs(System.currentTimeMillis() - mLastTime -mInterval)&lt;<span class="number">1000</span> || </span><br><span class="line">								((System.currentTimeMillis() - mLastTime -mInterval) &gt;<span class="number">0</span>)))&#123;</span><br><span class="line">					mLastTime = System.currentTimeMillis();</span><br><span class="line">					<span class="keyword">if</span> (currentPosition == size - <span class="number">1</span>) &#123;</span><br><span class="line">						currentPosition = <span class="number">0</span>;</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						currentPosition++;</span><br><span class="line">					&#125;</span><br><span class="line">					BannerViewManager.<span class="keyword">this</span>.sendEmptyMessage(SHOW_NEXT);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		mTimer = <span class="keyword">new</span> Timer();</span><br><span class="line">		mTimer.schedule(mTask, <span class="number">0</span>, mInterval);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//停止自动轮播</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopAutoSwitch</span><span class="params">()</span></span>&#123;</span><br><span class="line">		mIsRun = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span>(mTimer !=<span class="keyword">null</span> )&#123;</span><br><span class="line">			mTimer.cancel();</span><br><span class="line">			mTimer.purge();</span><br><span class="line">			mTimer = <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(mTask != <span class="keyword">null</span>)&#123;</span><br><span class="line">			mTask.cancel();</span><br><span class="line">			mTask = <span class="keyword">null</span>;</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// </span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showPreviousView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mImageSwitcher.setInAnimation(AnimationUtils.loadAnimation(mContext,</span><br><span class="line">				R.anim.adv_left_in));</span><br><span class="line">		mImageSwitcher.setOutAnimation(AnimationUtils.loadAnimation(mContext,</span><br><span class="line">				R.anim.adv_right_out));</span><br><span class="line">		displayImage(mBannerList.get(currentPosition % mBannerList.size())</span><br><span class="line">				);</span><br><span class="line">		mLastTime = System.currentTimeMillis();</span><br><span class="line">		setCurrTips(currentPosition);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// </span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showNextView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mImageSwitcher.setInAnimation(AnimationUtils.loadAnimation(mContext,</span><br><span class="line">				R.anim.adv_right_in));</span><br><span class="line">		mImageSwitcher.setOutAnimation(AnimationUtils.loadAnimation(mContext,</span><br><span class="line">				R.anim.adv_lift_out));</span><br><span class="line">		displayImage(mBannerList.get(currentPosition));</span><br><span class="line">		<span class="comment">// mImageSwitcher.setImageResource(mImages[currentPosition]);</span></span><br><span class="line">		mLastTime = System.currentTimeMillis();</span><br><span class="line">		setCurrTips(currentPosition);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 海报点击事件</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onBannerClick</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">		<span class="keyword">case</span> SHOW_NEXT:</span><br><span class="line">			showNextView();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SHOW_BANNERS:</span><br><span class="line">			initialize();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> downX;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> downY;</span><br><span class="line">	<span class="keyword">boolean</span> isVerticalScrolling = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">long</span> clickTime = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">		<span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">			isVerticalScrolling = <span class="keyword">false</span>;</span><br><span class="line">			clickTime = System.currentTimeMillis();</span><br><span class="line">			downX = event.getX();</span><br><span class="line">			downY = event.getY();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">			<span class="keyword">float</span> eventX = event.getX();</span><br><span class="line">			<span class="keyword">float</span> eventY = event.getY();</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(Math.abs(eventY-downY) &gt; <span class="number">4</span>*Math.abs(eventX - downX))&#123;</span><br><span class="line">				isVerticalScrolling = <span class="keyword">true</span>;</span><br><span class="line">				<span class="keyword">if</span>(mSv!=<span class="keyword">null</span>)</span><br><span class="line">					mSv.requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				isVerticalScrolling = <span class="keyword">false</span>;</span><br><span class="line">				<span class="keyword">if</span>(mSv!=<span class="keyword">null</span>)</span><br><span class="line">					mSv.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">			</span><br><span class="line">		<span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">			<span class="keyword">float</span> lastX = event.getX();</span><br><span class="line">			<span class="keyword">float</span> lastY = event.getY();</span><br><span class="line">			<span class="keyword">long</span> upTime = System.currentTimeMillis();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//阻止scrollview截获touch事件，banner收到action后调用这个方法，</span></span><br><span class="line">			<span class="comment">//scrollview就不会调用onInterceptEvent，scroll也无法截获后面的action了</span></span><br><span class="line">			<span class="keyword">if</span>(mSv!=<span class="keyword">null</span>)</span><br><span class="line">				mSv.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(isVerticalScrolling)&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">float</span> xDistance = Math.abs(lastX- downX);</span><br><span class="line">			<span class="keyword">float</span> yDistance = Math.abs(lastY- downY);</span><br><span class="line">			<span class="keyword">double</span> distance = Math.sqrt(xDistance*xDistance + yDistance*yDistance);</span><br><span class="line"><span class="comment">//			Logger.d("xxx","xxx:"+ distance);</span></span><br><span class="line">			<span class="keyword">if</span> (distance &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(upTime-clickTime &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">					onBannerClick();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (lastX - downX &gt; <span class="number">10</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (currentPosition &gt; <span class="number">0</span>) &#123;</span><br><span class="line">					currentPosition--;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					currentPosition = mBannerList.size() - <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				showPreviousView();</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> (downX - lastX &gt; <span class="number">10</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (currentPosition &lt; mBannerList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">					currentPosition++;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					currentPosition = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				showNextView();</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##需要额外注意的<br>如果 当做<code>ListView</code>的<code>Header</code>或者<code>Item</code>，或者外面有一个<code>Scrollview</code>之类的，会没法响应手指的左右滑动。需要添加 <code>requestDisallowInterceptTouchEvent</code> 来保证事件的传递。本文中构造方法传递进来的是一个 <code>Scrollview</code>，可以改成 <code>ListView</code>等之类。</p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2015/07/05/test2/" >
  test2
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2015/07/05/test2/"><span class="article-date">
  2015-07-05
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/">test</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p><a href="http://c4fun.cn/blog/2014/03/03/use-hexo-blog/" target="_blank" rel="external">Hexo 使用说明</a></p>

        
      </div>
    </div>

  






          <div class="main-footer">
  
    © 2016 CrossRun - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js"></script>


<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>
<script src="/scripts/main.js"></script>

</body>
</html>
